# Telegram 记账与多功能机器人使用手册

## 1. 简介
本机器人基于 ThinkPHP 6.0 框架开发，集成了强大的记账管理、实用工具查询以及群组管理功能。支持多群组、多操作人协作，并配备完善的 Web 后台管理系统。
机器人演示 @TG666668boT
---

## 2. 记账核心功能

### 2.1 入款 (加账)
*   **指令格式**：`+金额` 或 `+金额/汇率`
*   **示例**：
    *   `+100` (按默认汇率记账 100 RMB)
    *   `+100/7.2` (按 7.2 汇率记账 100 RMB)
*   **说明**：
    *   支持回复某人的消息进行加账（记在该用户头上）。
    *   直接发送则记在公共账目（用户名为 0）。

### 2.2 下发 (出款)
*   **指令格式**：`-金额` 或 `-金额/汇率` 或 `下发金额`
*   **示例**：
    *   `-50u`
    *   `-50/7.2`
    *   `下发50`
*   **说明**：支持回复消息指定收款人。

### 2.3 账单查询
*   **指令**：`/我` 或 `/账单` 或 `账单` (回复某人)
*   **功能**：查看个人今日账单汇总（入款、下发、余额）。
*   **指令**：`显示账单`
*   **功能**：(管理员) 查看当前群组的今日总账单。

### 2.4 日切与账期
*   **指令**：`开始`
*   **功能**：开始新的记账周期。
*   **指令**：`关闭记账`
*   **功能**：提前结束当前记账周期。
*   **指令**：`设置日切时间 HH:MM` (如 `设置日切时间 05:00`)
*   **功能**：设置群组自动日切时间。

### 2.5 汇率设置
*   **指令**：`设置汇率 数值`
*   **示例**：`设置汇率 7.3`
*   **功能**：设置当前群组的默认计算汇率，并自动更新群名后缀。

---

## 3. 实用工具箱

### 3.1 智能计算器
*   **支持格式**：`+ - * /` 混合运算
*   **示例**：`5+5`、`1000/7.2`、`100*0.95`
*   **说明**：支持群聊和私聊，自动识别算式并回复结果。

### 3.2 距离查询 (V5.0)
*   **指令**：`距离 起点-终点`
*   **示例**：`距离 北京-上海`
*   **高级用法**：回复一条包含地址的消息（如“预约明天 河北唐山...”），发送“广州天河”，机器人会自动提取原消息中的地址作为起点，计算到广州天河的距离和时间。

### 3.3 实时汇率查询
*   **指令**：
    *   `z0`：查询支付宝 (Alipay) 实时汇率
    *   `k0`：查询银行卡 (Bank) 实时汇率
    *   `w0`：查询微信 (WeChat) 实时汇率
*   **说明**：数据源自 OKX OTC 市场 Top 15 商家。

### 3.4 信息查询
*   **查手机号**：`s 手机号` (如 `s 13800138000`)
    *   返回：归属地、运营商 (使用 360 接口)。
*   **查身份证**：`sfz 身份证号` (如 `sfz 110101199001011234`)
    *   返回：归属地、生日、性别 (多接口轮询 + 本地算法)。
*   **查银行卡**：`查卡 卡号` 或 `ck 卡号`
    *   返回：银行名称、卡种 (支付宝接口)。
*   **查 TRC20 地址**：(仅私聊) 发送 TRC20 地址
    *   返回：USDT/TRX 余额、最近 5 笔交易记录。

---

## 4. 群组与权限管理

### 4.1 操作人管理
*   **指令**：`添加操作人 @用户名`
*   **指令**：`删除操作人 @用户名`
*   **指令**：`查询操作人`
*   **说明**：操作人拥有记账、查单、设置汇率等权限。

### 4.2 禁言控制
*   **指令**：`上课` (解除禁言)
*   **指令**：`下课` (开启禁言)

### 4.3 位置地址跨群监听与转发
*   **指令**：`开启监听` (在源群组发送)
*   **指令**：`关闭监听`
*   **指令**：`开启接单` (在目标群组发送)
*   **功能**：将源群组中包含地址信息的订单消息，自动转发到目标群组，方便车队接单。

### 4.4 消息通知
*   **指令**：`通知所有人 内容`
*   **功能**：@所有人 并发送通知内容。

---

## 5. 系统维护

### 5.1 进程守护
机器人核心消息处理依赖于 CLI 守护进程，请确保 Supervisor 运行正常。
*   **进程命令**：`php think tg:consume`
*   **说明**：支持数据库断线自动重连，无需频繁重启。

### 5.2 常见问题
*   **无反应**：请检查 Supervisor 进程是否运行，或发送 `5+5` 测试存活。
*   **权限不足**：请确认发送者是否已添加为管理员或操作人。

---
机器人演示 @TG666668boT 

